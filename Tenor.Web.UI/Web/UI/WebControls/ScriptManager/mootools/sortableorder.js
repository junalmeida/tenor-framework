var SortableOrder=new Class({options:{handles:false,onStart:Class.empty,onComplete:Class.empty,ghost:true,snap:3,onDragStart:function(A,B){B.setStyle("opacity",0.5)},onDragComplete:function(A,B){B.remove()}},initialize:function(B,A){this.setOptions(A);this.list=$(B);this.elements=this.list.getChildren();this.handles=$$(this.options.handles)||this.elements;this.drag=[];this.bound={"start":[]};this.positions=[];this.elements.each(function(F,E){F.position=E;F.dropIn=null;F.addEvents({over:function(G){G.dropIn=this;var H=$("debug");if(H){H.innerHTML+=" over this:"+this.position}}});var C=$A(this.elements);C.remove(F);this.trash=new Element("div").injectInside(document.body);var D=this.list.getCoordinates();this.drag[E]=new Drag.Move(F,{handle:this.handles[E],snap:false,droppables:C,onBeforeStart:function(G){var H=G.getPosition();this.old=G;this.drag[E].element=this.ghost=G.clone().setStyles({"position":"absolute","top":H.y+"px","left":H.x+"px"}).injectInside(this.trash);G.setStyle("visibility","hidden");this.fireEvent("onDragStart",[F,this.ghost])}.bind(this),onComplete:function(G){this.old.setStyle("visibility","visible");this.drag[E].element=this.old;this.fireEvent("onDragComplete",[F,this.ghost]);this.fireEvent("onComplete")}.bind(this),onDrag:function(G){var H=this.old;if(G.dropIn!=null&&G.dropIn.position!=H.position){if(H.position<G.dropIn.position){(G.dropIn.getNext())?H.parentNode.insertBefore(H,G.dropIn.getNext()):H.parentNode.insertBefore(H,null)}else{if(H.position>G.dropIn.position){H.parentNode.insertBefore(H,G.dropIn)}}this.updateOrder(H.position,G.dropIn.position);G.dropIn=null}}.bind(this)})},this);if(this.options.initialize){this.options.initialize.call(this)}this.positions.each(function(D,C){alert(C+" "+D)})},updateOrder:function(A,B){this.elements.each(function(C){if(C.position==A){C.position=B}else{if(C.position>A&&C.position<=B){C.position--}else{if(C.position<A&&C.position>=B){C.position++}}}})},detach:function(){this.elements.each(function(B,A){this.handles[A].removeEvent("mousedown",this.bound.start[A])},this)},serialize:function(){var A=[];this.list.getChildren().each(function(C,B){A[B]=this.elements.indexOf(C)},this);return A},end:function(A){document.removeEvent("mousemove",this.bound.move);document.removeEvent("mouseup",this.bound.end);this.fireEvent("onComplete",A)}});SortableOrder.implement(new Events);SortableOrder.implement(new Options)