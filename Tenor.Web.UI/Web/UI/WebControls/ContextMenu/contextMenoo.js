var DDMenu=new Class({Implements:[Events,Options],options:{onOpen:$empty,onClose:$empty,onItemSelect:$empty,observe_disabled_items:false,rightclick_to_open:true,crtl_switch:true,shift_with_contentmenu:true,fade_in:true,cursorx:2,cursory:1,opacity:0.95},initialize:function(C,B,A){this.setOptions(A);this.eMenu=$(C);this.eBindon=$(B);this.eMenu.setStyles({position:"absolute","z-index":9999,display:"none"});this.open=this.open.bindWithEvent(this);this.close=this.close.bind(this);this.preOpenEvent=this.preOpenEvent.bind(this);this.menuEvent=this.menuEvent.bindWithEvent(this);this.clickedElement=$empty;this.eBindon.addEvents({mousedown:function(){this.eBindon.addEvent("contextmenu",$break)}.bind(this),mouseup:this.preOpenEvent});$$("#"+C+" li a").addEvent("click",$break)},preOpenEvent:function(A){if(A.shift){this.eBindon.removeEvent("contextmenu",$break)}else{if(this.options.crtl_switch&&A.rightClick&&A.control){this.eBindon.removeEvent("contextmenu",$break);return true}}A.preventDefault();if(this.eMenu.style.display=="block"){this.close(A)}this.clickedElement=$(A.target);if(A.rightClick){if(this.options.crtl_switch&&A.control){return true}else{if(this.options.rightclick_to_open){this.open(A)}}}else{if(A.control){this.open(A)}else{return true}}return false},open:function(A){this.eMenu.setStyles({opacity:0,display:"block","z-index":99999,top:A.page.y+this.options.cursory,left:A.page.x+this.options.cursorx});var B={};this.eMenu.getPosition().y-$E("body").getScroll().y+this.eMenu.getOffsetSize().y<$E("body").getOffsetSize().y?B.y=A.page.y+this.options.cursory:B.y=A.page.y-this.eMenu.getOffsetSize().y+this.options.cursory;if(B.y<$E("body").getScroll().y+1){B.y=$E("body").getScroll().y+1}this.eMenu.getPosition().x-$E("body").getScroll().x+this.eMenu.getOffsetSize().x<$E("body").getOffsetSize().x?B.x=A.page.x+this.options.cursorx:B.x=A.page.x-this.eMenu.getOffsetSize().x+this.options.cursorx;if(B.x<$E("body").getScroll().x+1){B.x=$E("body").getScroll().x+1}if(A.shift){B.x=A.page.x-this.eMenu.getOffsetSize().x-this.options.cursorx}this.eMenu.setStyles({top:B.y,left:B.x});if(this.options.fade_in){var D=this.options.opacity;var C=new Fx.Morph(this.eMenu,{duration:200}).start({opacity:[0.32,D]})}else{this.eMenu.style.opacity=this.options.opacity}window.addEvent("blur",function(){if(!Browser.Engine.trident){this.close()}}.bind(this));document.addEvent("mousedown",this.menuEvent);this.eMenu.addEvents({contextmenu:function(){return false},mouseup:this.menuEvent});this.fireEvent("onOpen",A)},menuEvent:function(B){B.preventDefault();var A=$(B.target);if(A==this.eMenu||A==this.eMenu.getElement("ul")){return false}A=this.ascendTo(A,["item","sepline","title"]);if(A===false){this.close(B)}else{if(A.hasClass("item")&&B.type=="mouseup"){if(!(A.getElement("a").hasClass("disabled")&&!this.options.observe_disabled_items)){this.action(A);this.close(B)}}}},close:function(A){this.eMenu.style.display="none";document.removeEvent("mousedown",this.menuEvent);window.removeEvent("blur",function(){if(!Browser.Engine.trident){this.close()}}.bind(this));this.eMenu.removeEvents();this.fireEvent("onClose",A)},action:function(A){this.fireEvent("onItemSelect",[A.get("id"),this.clickedElement,this.eBindon]);return },ascendTo:function(C,D){if(C==window){return false}var A=C;while(A.get("tag")!="html"){for(var B=0;B<D.length;B++){if(A.hasClass(D[B])){return A}}A=A.getParent()}return false},enableThisItemsOnly:function(A,B){if(!$chk(B)&&B!=false){B=true}if($type(A)=="string"){A=[A]}if(!A.length){return }B==true?this.eMenu.getElements("li.item a").addClass("disabled"):this.eMenu.getElements("li.item a").removeClass("disabled");A.each(function(C){B==true?this.eMenu.getElement("li#"+C+" a").removeClass("disabled"):this.eMenu.getElement("li#"+C+" a").addClass("disabled")}.bind(this))},enableItems:function(A,B){if(!$chk(A)&&A!=false){A=true}if($type(A)=="boolean"){A==true?this.eMenu.getElements("li.item a").removeClass("disabled"):this.eMenu.getElements("li.item a").addClass("disabled");return }if(!$chk(B)&&B!=false){B=true}if($type(A)=="string"){A=[A]}A.each(function(C){B==true?this.eMenu.getElement("li#"+C+" a").removeClass("disabled"):this.eMenu.getElement("li#"+C+" a").addClass("disabled")}.bind(this))}});$break=function(){return false};